<div class="dashboard-container">
    <div class="dashboard-header">
        <h2>ğŸ“Š Dashboard Administrativo</h2>
        <div class="periodo-selector">
            <button
                    [class.active]="periodo === 7"
                    (click)="mudarPeriodo(7)">
                7 dias
            </button>
            <button
                    [class.active]="periodo === 30"
                    (click)="mudarPeriodo(30)">
                30 dias
            </button>
            <button
                    [class.active]="periodo === 90"
                    (click)="mudarPeriodo(90)">
                90 dias
            </button>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-spinner" *ngIf="carregando">
        <div class="spinner"></div>
        <p>Carregando dashboard...</p>
    </div>

    <!-- Erro -->
    <div class="alert alert-danger" *ngIf="mensagemErro && !carregando">
        âŒ {{ mensagemErro }}
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content" *ngIf="!carregando && dashboardData">

        <!-- Cards de Resumo -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.totalUsuarios }}</div>
                    <div class="stat-label">UsuÃ¡rios Cadastrados</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.totalPontoColetas }}</div>
                    <div class="stat-label">Pontos de Coleta</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">â™»ï¸</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.materiaisValidados }}</div>
                    <div class="stat-label">Materiais Validados</div>
                </div>
            </div>

            <div class="stat-card warning" *ngIf="dashboardData.resumo.materiaisPendentes > 0">
                <div class="stat-icon">â³</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.materiaisPendentes }}</div>
                    <div class="stat-label">Pendentes de ValidaÃ§Ã£o</div>
                </div>
            </div>

            <div class="stat-card success">
                <div class="stat-icon">âœ…</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.taxaValidacao }}%</div>
                    <div class="stat-label">Taxa de ValidaÃ§Ã£o</div>
                </div>
            </div>

            <div class="stat-card danger" *ngIf="dashboardData.resumo.alertasEstoque > 0">
                <div class="stat-icon">âš ï¸</div>
                <div class="stat-info">
                    <div class="stat-value">{{ dashboardData.resumo.alertasEstoque }}</div>
                    <div class="stat-label">Alertas de Estoque</div>
                </div>
            </div>
        </div>

        <!-- Materiais por Tipo -->
        <div class="section-card">
            <h3>â™»ï¸ Materiais por Tipo</h3>
            <div class="materiais-list">
                <div class="material-item" *ngFor="let material of dashboardData.materiaisPorTipo">
                    <div class="material-icon">{{ getIconeMaterial(material._id) }}</div>
                    <div class="material-info">
                        <div class="material-nome">{{ material._id }}</div>
                        <div class="material-stats">
                            <span>{{ material.totalQuantidade }}kg</span>
                            <span>â€¢</span>
                            <span>{{ material.totalPontos }} pontos</span>
                            <span>â€¢</span>
                            <span>{{ material.count }} registros</span>
                        </div>
                    </div>
                </div>

                <div class="empty-state" *ngIf="dashboardData.materiaisPorTipo.length === 0">
                    <p>Nenhum material reciclado no perÃ­odo selecionado</p>
                </div>
            </div>
        </div>

        <!-- Top 5 Pontos de Coleta -->
        <div class="section-card">
            <h3>ğŸ† Top Pontos de Coleta</h3>
            <div class="pontos-list">
                <div class="ponto-item" *ngFor="let ponto of dashboardData.materiaisPorPonto.slice(0, 5); let i = index">
                    <div class="ponto-posicao">{{ i + 1 }}Âº</div>
                    <div class="ponto-info">
                        <div class="ponto-nome">{{ ponto.pontoNome }}</div>
                        <div class="ponto-endereco">{{ ponto.pontoEndereco }}</div>
                        <div class="ponto-stats">
                            {{ ponto.totalQuantidade }}kg â€¢ {{ ponto.totalMateriais }} materiais
                        </div>
                    </div>
                </div>

                <div class="empty-state" *ngIf="dashboardData.materiaisPorPonto.length === 0">
                    <p>Nenhum material registrado nos pontos de coleta</p>
                </div>
            </div>
        </div>

        <!-- TendÃªncia (Ãºltimos 7 dias) -->
        <div class="section-card">
            <h3>ğŸ“ˆ TendÃªncia de Reciclagem (Ãºltimos 7 dias)</h3>
            <div class="tendencia-list">
                <div class="tendencia-item" *ngFor="let dia of dashboardData.tendencia">
                    <div class="tendencia-data">{{ dia._id }}</div>
                    <div class="tendencia-barra">
                        <div
                                class="tendencia-progresso"
                                [style.width.%]="(dia.totalQuantidade / getMaxTendencia()) * 100">
                        </div>
                    </div>
                    <div class="tendencia-valor">
                        {{ dia.totalQuantidade }}kg ({{ dia.totalMateriais }} materiais)
                    </div>
                </div>

                <div class="empty-state" *ngIf="dashboardData.tendencia.length === 0">
                    <p>Sem dados de tendÃªncia para os Ãºltimos 7 dias</p>
                </div>
            </div>
        </div>

        <!-- Top UsuÃ¡rios -->
        <div class="section-card">
            <h3>ğŸ‘‘ Top 5 UsuÃ¡rios</h3>
            <div class="usuarios-list">
                <div class="usuario-item" *ngFor="let usuario of dashboardData.topUsuarios.slice(0, 5); let i = index">
                    <div class="usuario-posicao" [class.top3]="i < 3">
                        <span *ngIf="i === 0">ğŸ¥‡</span>
                        <span *ngIf="i === 1">ğŸ¥ˆ</span>
                        <span *ngIf="i === 2">ğŸ¥‰</span>
                        <span *ngIf="i > 2">{{ i + 1 }}Âº</span>
                    </div>
                    <div class="usuario-info">
                        <div class="usuario-nome">{{ usuario.nome }}</div>
                        <div class="usuario-email">{{ usuario.email }}</div>
                    </div>
                    <div class="usuario-pontos">
                        ğŸ† {{ usuario.pontos }} pontos
                    </div>
                </div>

                <div class="empty-state" *ngIf="dashboardData.topUsuarios.length === 0">
                    <p>Nenhum usuÃ¡rio com pontos registrados</p>
                </div>
            </div>
        </div>

    </div>
</div>